<%- include('../partials/header') %>

    <div class="layout-wrapper">
        <%- include('../partials/sidebar', { user: user, page: page }) %>

            <div class="main-content">
                <header style="margin-bottom: 40px;">
                    <h1 style="margin-bottom: 10px;">Billing History</h1>
                    <p class="text-muted">A complete record of all your bills.</p>
                </header>

                <% if (bills.length> 0) { %>
                    <div class="card" style="padding: 0; overflow: hidden;">
                        <div style="overflow-x: auto;">
                            <table style="margin: 0;">
                                <thead style="background: var(--bg-input);">
                                    <tr>
                                        <th style="padding-left: 32px;">Date</th>
                                        <th>Description</th>
                                        <th>Total Bill</th>
                                        <th>Your Share</th>
                                        <th style="padding-right: 32px;">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% bills.forEach(bill=> { %>
                                        <tr style="transition: background 0.2s;">
                                            <td class="text-muted" style="padding-left: 32px;">
                                                <%= new Date(bill.date).toLocaleDateString() %>
                                            </td>
                                            <td style="font-weight: 500; color: var(--text-main);">
                                                <%= bill.description %>
                                            </td>
                                            <td>₹<%= bill.totalAmount %>
                                            </td>
                                            <td style="font-family: monospace; font-size: 1.1em;">₹<%=
                                                    bill.individualShare %>
                                            </td>
                                            <td style="padding-right: 32px;">
                                                <span
                                                    class="<%= bill.myPayment.status === 'Paid' ? 'text-success' : (bill.myPayment.status === 'Unpaid' || bill.myPayment.status === 'Declined' ? 'text-error' : 'text-muted') %>"
                                                    style="font-weight: 600; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.05em; display: inline-flex; align-items: center; gap: 8px;">
                                                    <% if (bill.myPayment.status==='Paid' ) { %>
                                                        <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px;"
                                                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M5 13l4 4L19 7" />
                                                        </svg>
                                                        <% } %>
                                                            <%= bill.myPayment.status ?
                                                                bill.myPayment.status.replace('_', ' ' ) : 'N/A' %>
                                                </span>
                                            </td>
                                        </tr>
                                        <% }) %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <% } else { %>
                        <div class="card" style="padding: 60px; text-align: center;">
                            <p class="text-muted">No bills recorded in the system yet.</p>
                        </div>
                        <% } %>

            </div>
    </div>

    <%- include('../partials/footer') %>